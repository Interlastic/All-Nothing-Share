<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pick your Device!</title>
  <link rel="icon" type="image/x-icon" href="ico.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrapper">
  <div class="transitionbox" style="opacity: 100;"></div>
  <div class="top-bar"></div>
  <div class="top-bar-home" onclick="transitionBoxActivate('/')">
    <div class="top-bar-home-text"><-HOME</div>
  </div>
  <div class="top-bar-dropdown">
 <div class="top-bar-dropdown-text">{{PHONE_NAME}}</div>
  <div class="dropdown-content">
  <a href="#" onclick="transitionBoxActivate('{{OTHERPHONE1_HREF}}')">{{OTHER_PHONE1}}</a>
  <a href="#" onclick="transitionBoxActivate('{{OTHERPHONE2_HREF}}')">{{OTHER_PHONE2}}</a>
  <a href="#" onclick="transitionBoxActivate('{{OTHERPHONE3_HREF}}')">{{OTHER_PHONE3}}</a>
  <a href="#" onclick="transitionBoxActivate('{{OTHERPHONE4_HREF}}')">{{OTHER_PHONE4}}</a>
  <a href="#" onclick="transitionBoxActivate('/')">Other Devices...</a>
  </div>
</div>
 <div class="sidebar">
  <div class="sidebar-arrow"></div>
  <div class="sidebar-content">
    <div class="sidebar-select" data-hash="#App">
      <div class="sidebar-select-text">Apps</div>
    </div>
    <div class="sidebar-select" style="top: 34.25%;" data-hash="#Ringtone">
      <div class="sidebar-select-text">Ringtones</div>
    </div>
    <div class="sidebar-select" style="top: 68.5%;" data-hash="#Wallpaper">
      <div class="sidebar-select-text">Wallpapers</div>
    </div>
  </div>
  </div>
  <div id="root"></div>
  </div>
  <!-- React and ReactDOM CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <script>
    const { useState, useEffect } = React;

    function ItemsList() {
      const [items, setItems] = useState([]);

      useEffect(() => {
        fetch('/items')
          .then(response => {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = '';

            function read() {
              reader.read().then(({ done, value }) => {
                if (done) return;

                buffer += decoder.decode(value, { stream: true });

                let lines = buffer.split('\n');
                buffer = lines.pop(); // last line may be incomplete

                lines.forEach(line => {
                  if (line.trim()) {
                    try {
                      const item = JSON.parse(line);
                      setItems(prev => [...prev, item]);
                    } catch (e) {
                      console.error('Invalid JSON line:', line);
                    }
                  }
                });

                read();
              });
            }

            read();
          })
          .catch(console.error);
      }, []);

      console.log('Rendering ItemsList, items:', items);

      return React.createElement(
        'div',
        { className: 'item-container' },
        items.map(item => {
          console.log('Rendering item:', item);
          return React.createElement(
        'div',
        { key: item.id, className: 'item-card', id: item.type },
        React.createElement(
          'h3',
          { 
            className: 'item-text',
            style: { 
          fontFamily: 'NFont, sans-serif', 
          fontSize: '30px', 
          color: '#FFFFFF', 
          textAlign: 'center' 
            } 
          }, 
          item.name
        ),
        React.createElement(
          'p',
          { className: 'item-type' },
          'Type: ' + item.type
        ),
        React.createElement(
          'p',
          { className: 'item-desc' },
          item.description
        ),
        // Now uuuuhhh lets add what devices the app supports.
        React.createElement(
          'p',
          { className: 'item-supports' },
          React.createElement(
            'span',
            null,
            'Supports: ',
            React.createElement('br')
          ),
          ...item.supports.map((support, idx) => {
            console.log('Support for item', item.id, ':', support);
            return React.createElement(
          'strong',
          { 
            key: idx, 
            className: support === '{{PHONE_NAMENOSPACE}}' ? 'item-support-current' : 'item-support'
          },
          support,
          idx < item.supports.length - 1 ? React.createElement('span', null, '', React.createElement('br')) : ''
            );
          })
        )
          );
        })
      );
    }
    console.log('Current Phone: {{PHONE_NAME}}')

    ReactDOM.createRoot(document.getElementById('root')).render(
      React.createElement(ItemsList)
    );

    const speedRatio = 3;
    
    window.addEventListener('scroll', function () {
      let scrollY = window.pageYOffset;
      let slowScrollY = scrollY / speedRatio;
      document.body.style.backgroundPositionY = -slowScrollY + 'px';
    });

    //when all loaded, hide transitionbox
    document.addEventListener('DOMContentLoaded', () => {
    const boxes = document.querySelectorAll('.transitionbox');
    boxes.forEach(box => {
      box.style.opacity = '0';
    });
  });

function transitionBoxActivate(link) {
 const boxes = document.querySelectorAll('.transitionbox');
 boxes.forEach(box => {
   box.style.opacity = '1';
   box.style.transition = 'opacity 0.6s ease-in-out';
 });
 
 setTimeout(() => {
   window.location.href = link;
 }, 600);
}
function scrollToHash(hash) {
  const target = document.querySelector(hash);
  if (target) {
    target.scrollIntoView({ behavior: 'smooth', block: 'start'});
  }
}

// Example: when you click your sidebar items
document.querySelectorAll('.sidebar-select').forEach(el => {
  el.addEventListener('click', (e) => {
    const hash = el.getAttribute('data-hash'); // weâ€™ll use data-hash instead of onclick
    history.pushState(null, '', hash);        // updates the URL without jumping
    scrollToHash(hash);
  });
});
  </script>
</body>
</html>