<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pick your Device!</title>
  <link rel="icon" type="image/x-icon" href="ico.png" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="transitionbox" style="opacity: 100;"></div>
  <div id="root"></div>

  <!-- React and ReactDOM CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

  <script>
    const { useState, useEffect } = React;

    function ItemsList() {
      const [items, setItems] = useState([]);

      useEffect(() => {
        fetch('/items')
          .then(response => {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = '';

            function read() {
              reader.read().then(({ done, value }) => {
                if (done) return;

                buffer += decoder.decode(value, { stream: true });

                let lines = buffer.split('\n');
                buffer = lines.pop(); // last line may be incomplete

                lines.forEach(line => {
                  if (line.trim()) {
                    try {
                      const item = JSON.parse(line);
                      setItems(prev => [...prev, item]);
                    } catch (e) {
                      console.error('Invalid JSON line:', line);
                    }
                  }
                });

                read();
              });
            }

            read();
          })
          .catch(console.error);
      }, []);

      return React.createElement(
        'div',
        { className: 'item-container' },
        items.map(item =>
          React.createElement(
            'div',
            { key: item.id, className: 'item-card' },
            React.createElement(
              'h3',
              { 
                className: 'item-text',
                style: { 
                  fontFamily: 'NFont, sans-serif', 
                  fontSize: '30px', 
                  color: '#FFFFFF', 
                  textAlign: 'center' 
                } 
              }, 
              item.name
            ),
            React.createElement(
              'p',
              { className: 'item-type' },
              'Type: ' + item.type
            ),
            React.createElement(
              'p',
              { className: 'item-desc' },
              item.description
            )
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(
      React.createElement(ItemsList)
    );

    const speedRatio = 3;
    
    window.addEventListener('scroll', function () {
      let scrollY = window.pageYOffset;
      let slowScrollY = scrollY / speedRatio;
      document.body.style.backgroundPositionY = -slowScrollY + 'px';
    });

    //when all loaded, hide transitionbox
    document.addEventListener('DOMContentLoaded', () => {
    const boxes = document.querySelectorAll('.transitionbox');
    boxes.forEach(box => {
      box.style.opacity = '0';
    });
  });

  </script>
</body>
</html>
